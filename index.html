<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MirrorGPT</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#343541] text-gray-100 font-sans flex flex-col h-screen">


    <div id="chat-container" class="flex-1 overflow-y-auto">
        <div id="chat" class="w-full max-w-3xl mx-auto p-4 space-y-6">

        </div>
    </div>


    <div class="w-full bg-[#343541] border-t border-gray-600 pt-4 pb-6">
        <div class="w-full max-w-3xl mx-auto relative">
            <input id="input" type="text" placeholder="Send a message..."
                class="w-full bg-[#40414F] border border-gray-600 rounded-lg p-4 pr-14 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all" />
            <button id="sendBtn"
                class="absolute right-3 top-1/2 -translate-y-1/2 p-2 rounded-lg bg-transparent hover:bg-gray-600 text-gray-400 hover:text-white transition-colors">

                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                    <path
                        d="M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z" />
                </svg>
            </button>
        </div>
    </div>

    <script>

        const apiKey = 'AIzaSyBLZLwaHGcJWWPH7wFFUX4mtZNU8Cm95ls';

        const chatDiv = document.getElementById('chat');
        const input = document.getElementById('input');
        const sendBtn = document.getElementById('sendBtn');
        const chatContainer = document.getElementById('chat-container');


        const botIconSvg = `
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 41 41" fill="none" class="w-8 h-8">
        <path d="M35.215 40.222c5.808-5.808 5.808-15.208 0-21.016-5.808-5.808-15.208-5.808-21.016 0-5.808 5.808-5.808 15.208 0 21.016 5.808 5.808 15.208 5.808 21.016 0z" fill="#fff"></path>
        <path d="M31.758 15.766c.28-.532.449-1.12.449-1.748 0-1.932-1.568-3.5-3.5-3.5-1.026 0-1.932.449-2.583 1.162l-3.36 3.36c-.651.651-1.026 1.54-1.026 2.472v1.748h1.748c.932 0 1.82-.375 2.471-1.026l3.36-3.36-.008-.104z" fill="#000"></path>
        <path d="M21.233 25.291c-.28.532-.449 1.12-.449 1.748 0 1.932 1.568 3.5 3.5 3.5 1.026 0 1.932-.449 2.583-1.162l3.36-3.36c.651-.651 1.026-1.54 1.026-2.472v-1.748h-1.748c-.932 0-1.82.375-2.471 1.026l-3.36 3.36.008.104z" fill="#000"></path>
        <path d="M15.766 9.242c-.532-.28-1.12-.449-1.748-.449-1.932 0-3.5 1.568-3.5 3.5 0 1.026.449 1.932 1.162 2.583l3.36 3.36c.651.651 1.54 1.026 2.472 1.026h1.748v-1.748c0-.932-.375-1.82-1.026-2.471l-3.36-3.36.104-.008z" fill="#000"></path>
        <path d="M25.291 19.767c.532.28 1.12.449 1.748.449 1.932 0 3.5-1.568 3.5-3.5 0-1.026-.449-1.932-1.162-2.583l-3.36-3.36c-.651-.651-1.54-1.026-2.472-1.026H21.8v1.748c0 .932.375 1.82 1.026 2.471l3.36 3.36-.104.008z" fill="#000"></path>
      </svg>
    `;

        const userIconSvg = `
      <div class="w-8 h-8 rounded-sm bg-blue-500 flex items-center justify-center font-bold text-white">
        U
      </div>
    `;

        function showInitialUI() {
            chatDiv.innerHTML = `
            <div class="text-center pt-20">
                <h1 class="text-4xl font-bold">MirrorGPT</h1>
                <p class="text-lg text-gray-400">Hi Samin's Friend! I'm MirrorGPT, a friendly chatbot. Ask me anything!</p>
            </div>
        `;
        }

        function appendMessage(text, sender) {
            const isUser = sender === 'user';

            const messageWrapper = document.createElement('div');
            messageWrapper.className = `w-full flex gap-4 p-4 rounded-lg ${isUser ? 'bg-transparent' : 'bg-[#444654]'
                }`;


            if (text === 'Typing...' && !isUser) {
                messageWrapper.id = 'typing-indicator';
            }

            const iconDiv = document.createElement('div');
            iconDiv.className = 'flex-shrink-0';
            iconDiv.innerHTML = isUser ? userIconSvg : botIconSvg;

            const textDiv = document.createElement('div');

            textDiv.className = 'text-lg whitespace-pre-wrap';
            textDiv.textContent = text;

            messageWrapper.appendChild(iconDiv);
            messageWrapper.appendChild(textDiv);
            chatDiv.appendChild(messageWrapper);


            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        async function sendMessage() {
            if (apiKey.trim() === '') {
                alert('ERROR: API Key is missing. Please add your Gemini API key in the script section of the HTML file.');
                return;
            }

            const userInput = input.value.trim();
            if (!userInput) return;


            if (chatDiv.querySelector('h1')) {
                chatDiv.innerHTML = '';
            }

            appendMessage(userInput, 'user');
            input.value = '';

            appendMessage('Typing...', 'bot');

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userInput }] }]
                    })
                });

                if (!res.ok) {
                    const errorData = await res.json();
                    throw new Error(errorData.error.message || `HTTP error! status: ${res.status}`);
                }

                const data = await res.json();
                const reply = data?.candidates?.[0]?.content?.parts?.[0]?.text || 'Sorry, I could not get a response.';


                const typingIndicator = document.getElementById('typing-indicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }

                appendMessage(reply, 'bot');
            } catch (err) {
                const typingIndicator = document.getElementById('typing-indicator');
                if (typingIndicator) typingIndicator.remove();
                appendMessage('❌ Error: ' + err.message, 'bot');
            }
        }

        sendBtn.addEventListener('click', sendMessage);
        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });


        showInitialUI();
    </script>
</body>

</html>